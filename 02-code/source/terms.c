/*------------------------------ terms.c --------------------------------------------*/
/*----------------------------------------------------------------------------------*/
/* routines for calculating terms for matrices and vectors of linear system */
/*----------------------------------------------------------------------------------*/
#include <stdio.h>
#include <math.h>
/*----------------------------------------------------------------------------------*/
#include "boundary_types.h"

#include "geometry.h"

#include "terms.h"
/*----------------------------------------------------------------------------------*/
/*--------------------- voltage and current geometry terms -------------------------*/
/*----------------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------------*/
/*  calculate V_term P on S */
/*----------------------------------------------------------------------------------*/
double Vterm_PonS(x, y1, y2)
     double x, y1, y2;
{
  return(0.0);
}

/*----------------------------------------------------------------------------------*/
/*  calculate W_term P on S */
/*----------------------------------------------------------------------------------*/
double Wterm_PonS(x, y1, y2)
     double x, y1, y2;
{
  return(0.0);
}

/*----------------------------------------------------------------------------------*/
/*  calculate J_term P on S */
/*----------------------------------------------------------------------------------*/
double Jterm_PonS(x, y1, y2)
     double x, y1, y2;
{
  double y,len,J;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len*len;
  J = (((-Um(y1,y2)*y+3.0*Ul(y1,y2))*y
	             -3.0*Uk(y1,y2))*y+Uj(y1,y2))/len;
  J = J/(2.0*M_PI);
  return(J);
}

/*----------------------------------------------------------------------------------*/
/*  calculate K_term P on S */
/*----------------------------------------------------------------------------------*/
double Kterm_PonS(x, y1, y2)
     double x, y1, y2;
{
  double y,len,K;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len;
  K = ((Um(y1,y2)*y-2.0*Ul(y1,y2))*y+Uk(y1,y2))/len;
  K = K/(2.0*M_PI);
  return(K);
}

/*----------------------------------------------------------------------------------*/
/*  calculate L_term P on S */
/*----------------------------------------------------------------------------------*/
double Lterm_PonS(x, y1, y2)
     double x, y1, y2;
{
  double y,len,L;

  y=(y1+y2)/2.0;
  len=y2-y1;
  L = (-Um(y1,y2)*y+Ul(y1,y2))/len;
  L = L/(2.0*M_PI);
  return(L);
}

/*----------------------------------------------------------------------------------*/
/*  calculate M_term P on S */
/*----------------------------------------------------------------------------------*/
double Mterm_PonS(x, y1, y2)
     double x, y1, y2;
{
  double M;
  M = Um(y1,y2);
  M = M/(2.0*M_PI);
  return(M);
}

/*----------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------*/
double Uj(y1,y2)
     double y1,y2;
{
  double y1sq,y2sq,uj;

  y1=-y1;
  y1sq=y1*y1;
  y2sq=y2*y2;
  if(y1!=0.0){
    if(y2!=0.0){
      uj = (y2sq*y2sq*(log(y2)-0.25)-y1sq*y1sq*(log(y1)-0.25))/4.0;}
    else{
      uj = -y1sq*y1sq*(log(y1)-0.25)/4.0;}}
  else{
    if(y2!=0.0){
      uj = y2sq*y2sq*(log(y2)-0.25)/4.0;}
    else{
      uj = 0.0;}}
  return(uj);
}

/*----------------------------------------------------------------------------------*/
double Uk(y1,y2)
     double y1,y2;
{
  double y1sq,y2sq,uk;

  y1= -y1;
  y1sq=y1*y1;
  y2sq=y2*y2;
  if(y1!=0.0){
    if(y2!=0.0){
      uk = (y2*y2sq*(log(y2)-1.0/3.0)+y1*y1sq*(log(y1)-1.0/3.0))/3.0;}
    else{
      uk = y1*y1sq*(log(y1)-1.0/3.0)/3.0;}}
  else{
    if(y2!=0.0){
      uk = y2*y2sq*(log(y2)-1.0/3.0)/3.0;}
    else{
      uk = 0.0;}}
  return(uk);
}

/*----------------------------------------------------------------------------------*/
double Ul(y1,y2)
     double y1,y2;
{
  double y1sq,y2sq,ul;

  y1= -y1;
  y1sq=y1*y1;
  y2sq=y2*y2;
  if(y1!=0.0){
    if(y2!=0.0){
      ul = (y2sq*(log(y2)-0.5)-y1sq*(log(y1)-0.5))/2.0;}
    else{
      ul = -y1sq*(log(y1)-0.5)/2.0;}}
  else{
    if(y2!=0.0){
      ul = y2sq*(log(y2)-0.5)/2.0;}
    else{
      ul = 0.0;}}
  return(ul);
}

/*----------------------------------------------------------------------------------*/
double Um(y1,y2)
     double y1,y2;
{
  double um;

  y1= -y1;
  if(y1!=0.0){
    if(y2!=0.0){
      um = y2*(log(y2)-1.0)+y1*(log(y1)-1.0);}
    else{
      um = y1*(log(y1)-1.0);}}
  else{
    if(y2!=0.0){
      um = y2*(log(y2)-1.0);}
    else{
      um = 0.0;}}
  return(um);
}

/*----------------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------------*/
/*  calculate V_term P off S */
/*----------------------------------------------------------------------------------*/
double Vterm_PoffS(x, y1, y2)
     double x, y1, y2;
{
  double y,len,V;

  y=(y1+y2)/2.0;
  len=y2-y1;
  V = (-Tw(x,y1,y2)*y+Tv(x,y1,y2))/len;
  V = V/(2.0*M_PI);
  return(V);
}

/*----------------------------------------------------------------------------------*/
/*  calculate W_term P off S */
/*----------------------------------------------------------------------------------*/
double Wterm_PoffS(x, y1, y2)
     double x, y1, y2;
{
  double  W;

  W = Tw(x,y1,y2);
  W = W/(2.0*M_PI);
  return(W);
}

/*----------------------------------------------------------------------------------*/
/*  calculate J_term P off S */
/*----------------------------------------------------------------------------------*/
double Jterm_PoffS(x, y1, y2)
     double x, y1, y2;
{
  double y,len,J;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len*len;
  J = (((-Tm(x,y1,y2)*y+3.0*Tl(x,y1,y2))*y
	               -3.0*Tk(x,y1,y2))*y+Tj(x,y1,y2))/len;
  J = J/(2.0*M_PI);
  return(J);
}

/*----------------------------------------------------------------------------------*/
/*  calculate K_term P off S */
/*----------------------------------------------------------------------------------*/
double Kterm_PoffS(x, y1, y2)
     double x, y1, y2;
{
  double y,len,K;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len;
  K = ((Tm(x,y1,y2)*y-2.0*Tl(x,y1,y2))*y+Tk(x,y1,y2))/len;
  K = K/(2.0*M_PI);
  return(K);
}

/*----------------------------------------------------------------------------------*/
/*  calculate L_term P off S */
/*----------------------------------------------------------------------------------*/
double Lterm_PoffS(x, y1, y2)
     double x, y1, y2;
{
  double y,len,L;

  y=(y1+y2)/2.0;
  len=y2-y1;
  L = (-Tm(x,y1,y2)*y+Tl(x,y1,y2))/len;
  L = L/(2.0*M_PI);
  return(L);
}

/*----------------------------------------------------------------------------------*/
/*  calculate M_term P off S */
/*----------------------------------------------------------------------------------*/
double Mterm_PoffS(x, y1, y2)
     double x, y1, y2;
{
  double M;

  M = Tm(x,y1,y2);
  M = M/(2.0*M_PI);
  return(M);
}

/*----------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------*/
double Tv(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,tv;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2; 
  tv = -x*log((xsq+y2sq)/(xsq+y1sq))/2.0;
  return(tv);
}

/*----------------------------------------------------------------------------------*/
double Tw(x,y1,y2)
     double x,y1,y2;
{
  double tw;

  tw = -atan3(y2,y1,x);
  return(tw);
}

/*----------------------------------------------------------------------------------*/
double Tj(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,tj;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  tj = (((y2sq-xsq)*(xsq+y2sq)*log(xsq+y2sq)
	-(y1sq-xsq)*(xsq+y1sq)*log(xsq+y1sq))
	-(y2sq*(y2sq/2.0-xsq)-y1sq*(y1sq/2.0-xsq)))/8.0; 
  return(tj);
}

/*----------------------------------------------------------------------------------*/
double Tk(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,tk;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  tk = (y2sq*(y2*(log(xsq+y2sq)-2.0/3.0))
       -y1sq*(y1*(log(xsq+y1sq)-2.0/3.0)))/6.0
     + xsq/3.0*((y2-y1)-x*atan3(y2,y1,x));
  return(tk);
}

/*----------------------------------------------------------------------------------*/
double Tl(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,tl;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  tl = (((xsq+y2sq)*log(xsq+y2sq)
	-(xsq+y1sq)*log(xsq+y1sq))-(y2sq-y1sq))/4.0; 
  return(tl);
}

/*----------------------------------------------------------------------------------*/
double Tm(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,tm;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  tm = (y2*log(xsq+y2sq)-y1*log(xsq+y1sq))/2.0 
     - ((y2-y1)-x*atan3(y2,y1,x)); 
  return(tm);
}

/*----------------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------------*/
/*----------------------------- Gradient Terms -------------------------------------*/
/*----------------------------------------------------------------------------------*/
void V1(x, y1, y2, v)
     double x, y1, y2;
     coordinates v;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  v[0] = (-X1w(x,y1,y2)*y+X1v(x,y1,y2))/len;
  v[1] = (-Y1w(x,y1,y2)*y+Y1v(x,y1,y2))/len;
}

/*----------------------------------------------------------------------------------*/
void W1(x, y1, y2, w)
     double x, y1, y2;
     coordinates w;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  w[0] = X1w(x,y1,y2);
  w[1] = Y1w(x,y1,y2);
}

/*----------------------------------------------------------------------------------*/
void J1(x, y1, y2, j)
     double x, y1, y2;
     coordinates j;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len*len;
  j[0]=(((-X1m(x,y1,y2)*y+3.0*X1l(x,y1,y2))*y
	                 -3.0*X1k(x,y1,y2))*y+X1j(x,y1,y2))/len;
  j[1]=(((-Y1m(x,y1,y2)*y+3.0*Y1l(x,y1,y2))*y
	                 -3.0*Y1k(x,y1,y2))*y+Y1j(x,y1,y2))/len;
}

/*----------------------------------------------------------------------------------*/
void K1(x, y1, y2, k)
     double x, y1, y2;
     coordinates k;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len;
  k[0] = ((X1m(x,y1,y2)*y-2.0*X1l(x,y1,y2))*y+X1k(x,y1,y2))/len;
  k[1] = ((Y1m(x,y1,y2)*y-2.0*Y1l(x,y1,y2))*y+Y1k(x,y1,y2))/len;
}

/*----------------------------------------------------------------------------------*/
void L1(x, y1, y2, l)
     double x, y1, y2;
     coordinates l;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  l[0] = (-X1m(x,y1,y2)*y+X1l(x,y1,y2))/len;
  l[1] = (-Y1m(x,y1,y2)*y+Y1l(x,y1,y2))/len;
}

/*----------------------------------------------------------------------------------*/
void M1(x, y1, y2, m)
     double x, y1, y2;
     coordinates m;
{
  m[0] = X1m(x,y1,y2);
  m[1] = Y1m(x,y1,y2);
}

/*----------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------*/
double X1v(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xv;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  xv = -xsq*(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq))
     + log((xsq+y2sq)/(xsq+y1sq))/2.0;
  return(xv);
}

/*----------------------------------------------------------------------------------*/
double Y1v(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,yv;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  yv = x*(y2-y1)*(xsq-y2*y1)/((xsq+y2sq)*(xsq+y1sq))
     - atan3(y2,y1,x);
  return(yv);
}

/*----------------------------------------------------------------------------------*/
double X1w(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xw;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  xw = -(y2-y1)*(xsq-y2*y1)/((xsq+y2sq)*(xsq+y1sq));
  return(xw);
}

/*----------------------------------------------------------------------------------*/
double Y1w(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,yw;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  yw = -x*(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq));
  return(yw);
}

/*----------------------------------------------------------------------------------*/
double X1j(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xj;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  /****
  xj = -x*((y2sq-y1sq)-xsq*log((xsq+y2sq)/(xsq+y1sq)))/2.0;
  ***/
  xj = -x*((y2-y1)*(y2+y1)-xsq*log((xsq+y2sq)/(xsq+y1sq)))/2.0;
  return(xj);
}

/*----------------------------------------------------------------------------------*/
double Y1j(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,yj;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  /***
  yj = -(y2*y2sq-y1*y1sq)/3.0+xsq*((y2-y1)-x*atan3(y2,y1,x));
  yj = -(y2-y1)*(y2sq+y2*y1+y1sq)/3.0+xsq*((y2-y1)-x*atan3(y2,y1,x));
  ***/
  yj = -(y2-y1)*(y2sq+(y2+y1)*(y2+y1)+y1sq)/6.0+xsq*((y2-y1)-x*atan3(y2,y1,x));
  return(yj);
}

/*----------------------------------------------------------------------------------*/
double X1k(x,y1,y2)
     double x,y1,y2;
{
  double xk;

  xk = -x*((y2-y1)-x*atan3(y2,y1,x));
  return(xk);
}

/*----------------------------------------------------------------------------------*/
double Y1k(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,yk;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  yk = -((y2-y1)*(y2+y1)-xsq*log((xsq+y2sq)/(xsq+y1sq)))/2.0;
  return(yk);
}

/*----------------------------------------------------------------------------------*/
double X1l(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xl;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  xl = -x*log((xsq+y2sq)/(xsq+y1sq))/2.0;
  return(xl);
}

/*----------------------------------------------------------------------------------*/
double Y1l(x,y1,y2)
     double x,y1,y2;
{
  double yl;

  yl = -((y2-y1)-x*atan3(y2,y1,x));
  return(yl);
}

/*----------------------------------------------------------------------------------*/
double X1m(x,y1,y2)
     double x,y1,y2;
{
  double xm;

  xm = -atan3(y2,y1,x);
  return(xm);
}

/*----------------------------------------------------------------------------------*/
double Y1m(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,ym;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  ym = -log((xsq+y2sq)/(xsq+y1sq))/2.0;
  return(ym);
}

/*----------------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------------*/
/*------------------------ second derivative terms ---------------------------------*/
/*----------------------------------------------------------------------------------*/
void V2(x, y1, y2, v)
     double x, y1, y2;
     tensor v;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  v[0][0] = (-X2w(x,y1,y2)*y+X2v(x,y1,y2))/len;
  v[0][1] = (-Z2w(x,y1,y2)*y+Z2v(x,y1,y2))/len;
  v[1][0] =  v[0][1];
  v[1][1] = -v[0][0];
}

/*----------------------------------------------------------------------------------*/
void W2(x, y1, y2, w)
     double x, y1, y2;
     tensor w;
{
  w[0][0] = X2w(x,y1,y2);
  w[0][1] = Z2w(x,y1,y2);
  w[1][0] =  w[0][1];
  w[1][1] = -w[0][0];
}

/*----------------------------------------------------------------------------------*/
void J2(x, y1, y2, j)
     double x, y1, y2;
     tensor j;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len*len;
  j[0][0]=(((-X2m(x,y1,y2)*y+3.0*X2l(x,y1,y2))*y
	                    -3.0*X2k(x,y1,y2))*y+X2j(x,y1,y2))/len;
  j[0][1]=(((-Z2m(x,y1,y2)*y+3.0*Z2l(x,y1,y2))*y
	                    -3.0*Z2k(x,y1,y2))*y+Z2j(x,y1,y2))/len;
  j[1][0] =  j[0][1];
  j[1][1] = -j[0][0];
}

/*----------------------------------------------------------------------------------*/
void K2(x, y1, y2, k)
     double x, y1, y2;
     tensor k;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  len=len*len;
  k[0][0] = ((X2m(x,y1,y2)*y-2.0*X2l(x,y1,y2))*y+X2k(x,y1,y2))/len;
  k[0][1] = ((Z2m(x,y1,y2)*y-2.0*Z2l(x,y1,y2))*y+Z2k(x,y1,y2))/len;
  k[1][0] =  k[0][1];
  k[1][1] = -k[0][0];
}

/*----------------------------------------------------------------------------------*/
void L2(x, y1, y2, l)
     double x, y1, y2;
     tensor l;
{
  double y,len;

  y=(y1+y2)/2.0;
  len=y2-y1;
  l[0][0] = (-X2m(x,y1,y2)*y+X2l(x,y1,y2))/len;
  l[0][1] = (-Z2m(x,y1,y2)*y+Z2l(x,y1,y2))/len;
  l[1][0] =  l[0][1];
  l[1][1] = -l[0][0];
}

/*----------------------------------------------------------------------------------*/
void M2(x, y1, y2, m)
     double x, y1, y2;
     tensor m;
{
  m[0][0] = X2m(x,y1,y2);
  m[0][1] = Z2m(x,y1,y2);
  m[1][0] =  m[0][1];
  m[1][1] = -m[0][0];
}

/*----------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------*/
double X2v(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xv;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  /***
  xv = x*((2.0*xsq/(xsq+y2sq)-3.0)/(xsq+y2sq)
     -    (2.0*xsq/(xsq+y1sq)-3.0)/(xsq+y1sq)); 
  ***/
  xv = -x*(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq))
         *(2.0*xsq*(2.0*xsq+y2sq+y1sq)/((xsq+y2sq)*(xsq+y1sq))-3.0);
  return(xv);
}

/*----------------------------------------------------------------------------------*/
double Z2v(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,zv;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  /***
  zv = 2.0*(y2*(xsq/(xsq+y2sq)-1.0)/(xsq+y2sq)
     -      y1*(xsq/(xsq+y1sq)-1.0)/(xsq+y1sq)); 
  ***/
  zv = 2.0*(y2-y1)/((xsq+y2sq)*(xsq+y1sq))
          *(xsq*((xsq*(xsq-2.0*y2*y1)-(y2sq+(y2+y1)*(y2+y1)+y1sq)/2.0*y2*y1)) 
	         /((xsq+y2sq)*(xsq+y1sq))
	    -(xsq-y2*y1)); 
  return(zv);
}

/*----------------------------------------------------------------------------------*/
double X2w(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xw;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  /***
  xw = -2.0*x*(y2/(xsq+y2sq)/(xsq+y2sq)
	      -y1/(xsq+y1sq)/(xsq+y1sq));
  ***/
  xw = -2.0*(y2-y1)/((xsq+y2sq)*(xsq+y1sq))
           *x*(xsq*(xsq-2.0*y2*y1)-(y2sq+(y2+y1)*(y2+y1)+y1sq)/2.0*y2*y1)
              /((xsq+y2sq)*(xsq+y1sq)); 
  return(xw);
}

/*----------------------------------------------------------------------------------*/
double Z2w(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,zw;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  /***
  zw = (2.0*xsq/(xsq+y2sq)-1.0)/(xsq+y2sq)
     - (2.0*xsq/(xsq+y1sq)-1.0)/(xsq+y1sq); 
  ***/
  zw = -(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq))
       *(2.0*xsq*(2.0*xsq+y2sq+y1sq)/((xsq+y2sq)*(xsq+y1sq))-1.0);
  return(zw);
}

/*----------------------------------------------------------------------------------*/
double X2j(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xj;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  xj = (y2-y1)*(y2+y1)/2.0+xsq*(xsq*(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq))
			    -1.5*log((xsq+y2sq)/(xsq+y1sq))); 
  return(xj);
}

/*----------------------------------------------------------------------------------*/
double Z2j(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,zj;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  zj = -2.0*x*(y2-y1)-xsq*(x*(y2-y1)*(xsq-y2*y1)/((xsq+y2sq)*(xsq+y1sq))
			   -3.0*atan3(y2,y1,x));
  return(zj);
}

/*----------------------------------------------------------------------------------*/
double X2k(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xk;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  xk = (y2-y1)+x*(x*(y2-y1)*(xsq-y2*y1)/((xsq+y2sq)*(xsq+y1sq))
		  -2.0*atan3(y2,y1,x));
  return(xk);
}

/*----------------------------------------------------------------------------------*/
double Z2k(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,zk;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  zk = x*(xsq*(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq))
	  -log((xsq+y2sq)/(xsq+y1sq))); 
  return(zk);
}

/*----------------------------------------------------------------------------------*/
double X2l(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xl;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  xl = -xsq*(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq))+log((xsq+y2sq)/(xsq+y1sq))/2.0; 
  return(xl);
}

/*----------------------------------------------------------------------------------*/
double Z2l(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,zl;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  zl = x*(y2-y1)*(xsq-y2*y1)/((xsq+y2sq)*(xsq+y1sq))-atan3(y2,y1,x);
  return(zl);
}

/*----------------------------------------------------------------------------------*/
double X2m(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,xm;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  xm = -(y2-y1)*(xsq-y2*y1)/((xsq+y2sq)*(xsq+y1sq));
  return(xm);
}

/*----------------------------------------------------------------------------------*/
double Z2m(x,y1,y2)
     double x,y1,y2;
{
  double xsq,y1sq,y2sq,zm;

  xsq=x*x;
  y1sq=y1*y1;
  y2sq=y2*y2;
  zm = -x*(y2-y1)*(y2+y1)/((xsq+y2sq)*(xsq+y1sq));
  return(zm);
}
/*----------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------*/
